"use strict";var FrontendApp=angular.module("FrontendApp",["ui","ngResource","$strap.directives","ngCookies"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl"}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(a){var b=["$rootScope","$q","$location",function(a,b,c){function d(a){return a}function e(d){var e=d.status;if(e==401){var f=b.defer();return a.logged=!1,c.path("/login"),f.promise}return b.reject(d)}return function(a){return a.then(d,e)}}];a.responseInterceptors.push(b)}]);FrontendApp.factory("datamodel",function(a){var b={},c="http://localhost\\:3001";return b.User=a(c+"/users/:userid:action",{userid:"@userid",action:"@action"},{login:{method:"POST",params:{action:"login"}}}),b.Category=a(c+"/users/:userid/events/categories",{userid:"@userid"}),b.Event=a(c+"/users/:userid/events/:time1:eventid/:time2",{userid:"@userid",time1:"@time1",time2:"@time2",eventid:"@eventid"}),b}),"use strict",FrontendApp.controller("MainCtrl",function(a,b,c){var d=new Date,e=d.getDate(),f=d.getMonth(),g=d.getFullYear();b.events=[],b.eventCategories=[],b.filteredEvents=[],b.eventSources=[],b.equalsTracker=0,b.inputImportant=!1,b.userid=a.User.id,b.eventInfo={},$(".datepicker").datepicker(),$(".timepicker").timepicker({showMeridian:!1}),$("#calendar").fullCalendar({height:450,editable:!0,header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},eventSources:b.eventSources,eventClick:function(a,d,e){var f=c.Event.get({userid:b.userid,eventid:a.id},function(){var a=new Date(f.StartDate),c=new Date(f.EndDate),d;f.CategoryFK.id!=undefined?d=f.CategoryFK.id:d=f.CategoryFK,b.eventInfo.ID=f.id,b.eventInfo.Subject=f.Subject,b.eventInfo.Category=d,b.eventInfo.Location=f.Location,b.eventInfo.StartDate=a.toString("yyyy-MM-dd"),b.eventInfo.StartTime=a.toString("HH:mm"),b.eventInfo.EndDate=c.toString("yyyy-MM-dd"),b.eventInfo.EndTime=c.toString("HH:mm"),b.eventInfo.Description=f.Description,b.eventInfo.Important=f.Important,$("#modifyEventModal").modal("toggle"),$("#modifyEventModal").modal("show")})}}),b.fetchEvents=function(a,d){var e=b.userid;b.fetchCategories(),c.Event.query({userid:e,time1:a,time2:d},function(a){b.events=_.map(a,function(a){var b;return a.CategoryFK.id!=undefined?b=a.CategoryFK.id:b=a.CategoryFK,{id:a.id,title:a.Subject,category:b,color:a.CategoryFK.Color,start:new Date(a.StartDate),end:new Date(a.EndDate)}}),b.renderCalendar()})},b.fetchCategories=function(){var a=b.userid;c.Category.query({userid:a},function(a){b.eventCategories=_.map(a,function(a){return a.Checked=!0,a})})},b.renderCalendar=function(){b.filteredEvents=[];for(var a=0;a<b.eventCategories.length;a++){var c=b.eventCategories[a];if(c.Checked)for(var d=0;d<b.events.length;d++){var e=b.events[d];e.category==c.id&&b.filteredEvents.push(e)}}$("#calendar").fullCalendar("removeEvents"),$("#calendar").fullCalendar("addEventSource",b.filteredEvents)},b.remove=function(a){b.events.splice(a,1)},b.clearEventInfo=function(){b.eventInfo={}},b.addNewEvent=function(){var a=new c.Event({category:b.eventInfo.Category,type:1,subject:b.eventInfo.Subject,location:b.eventInfo.Location,start_date:b.eventInfo.StartDate+"T"+b.eventInfo.StartTime+"-0400",end_date:b.eventInfo.EndDate+"T"+b.eventInfo.EndTime+"-0400",description:b.eventInfo.Description,important:b.eventInfo.Important});a.$save({userid:b.userid},function(a){var c={id:a.id,title:a.Subject,start:a.StartDate,end:a.EndDate};b.fetchEvents()})},b.modifyEvent=function(){var a=new c.Event({id:b.eventInfo.ID,category:b.eventInfo.Category,type:1,subject:b.eventInfo.Subject,location:b.eventInfo.Location,start_date:b.eventInfo.StartDate+"T"+b.eventInfo.StartTime+"-0400",end_date:b.eventInfo.EndDate+"T"+b.eventInfo.EndTime+"-0400",description:b.eventInfo.Description,important:b.eventInfo.Important});a.$save({userid:b.userid,eventid:b.eventInfo.ID},function(a){b.fetchEvents()})},b.deleteEvent=function(){console.log(b.eventInfo.ID),c.Event.delete({userid:b.userid,eventid:b.eventInfo.ID},function(a){b.fetchEvents()})},b.uiConfig={fullCalendar:{height:450,editable:!0,header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"}}},b.fetchEvents(),b.fetchCategories()}),"use strict",FrontendApp.controller("LoginCtrl",function(a,b,c,d,e){b.login=function(){c.User.login({Username:b.inputUsername,Password:b.inputPassword},function(b){console.log(b),a.User=b,e.path("/")})}});